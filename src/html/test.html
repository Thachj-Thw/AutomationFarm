<!DOCTYPE html><html lang="en"><head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Hệ thống chăm sóc cây trồng tự động</title> <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <style>@import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');* { margin: 0px; padding: 0px; box-sizing: content-box; font-family: 'Varela Round', sans-serif; font-size: 17px;}:root { --bgcl: #e0e0e0; --navbar-width-open: 150px; --navbar-width-close: 45px; --navbar-padding-left: 5px; --navbar-padidng-right: 5px;}body { font-size: 16px; background-color: var(--bgcl);}#navbar { position: fixed; height: 100vh; width: var(--navbar-width-open); background: linear-gradient(45deg, rgb(17, 86, 88), rgb(47, 124, 51)); color: black; padding-top: 40px; padding-left: var(--navbar-padding-left); padding-right: 0px; overflow: hidden; transition: width 0.7s;}#navbar > a { display: block; position: relative; padding: 10px; cursor: context-menu; background: transparent; border-radius: 50px; color: black;}#navbar a i { font-size: 1.5rem;}#navbar a span { white-space: nowrap; position: fixed; transition: left 0.5s; left: calc(var(--navbar-padding-left) + 1.5rem + 20px);}#navbar a:hover{ color: #00a7ff;}#navbar a.select { background: var(--bgcl); position: relative;}#navbar a.select::after { content: ""; border-bottom-right-radius: 30%; position: absolute; background-color: transparent; width: 30px; height: 30px; top: -30px; right: 0px; box-shadow: 5px 5px var(--bgcl), 21px 25px var(--bgcl); z-index: -1;}#navbar a.select::before { content: ""; border-top-right-radius: 30%; position: absolute; background-color: transparent; width: 30px; height: 30px; bottom: -30px; right: 0px; box-shadow: 5px -5px var(--bgcl), 21px -25px var(--bgcl); z-index: -1;}#navbar.close { width: var(--navbar-width-close);}#navbar.close a span { left: var(--navbar-width-open);}#container { padding: 15px; position: relative; left: calc(var(--navbar-width-open) + var(--navbar-padding-left)); height: calc(100vh - 30px); width: calc(100% - (var(--navbar-width-open) + var(--navbar-padding-left) + 30px)); transition: 0.7s; background: var(--bgcl);}#navbar.close ~ #container { left: calc(var(--navbar-width-close) + var(--navbar-padding-left)); width: calc(100% - (var(--navbar-width-close) + var(--navbar-padding-left) + 30px));}.container-item{ border-radius: 15px; background-color: white; position: relative; min-height: 100px;}.container-item > .header { text-align: center; font-weight: bold; font-size: 20px; word-wrap: normal; margin-top: 10px; margin-left: 10px; margin-right: 10px;}.container-item > .body { transform: translateY(25%);}.container-item > .body > .value { font-size: 24px;}.dashboard-container { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; grid-template-rows: 1fr 1fr 1fr 1fr; grid-gap: 15px; grid-template-areas:  "h1 h1 h1 h1 h2" "h1 h1 h1 h1 h3" "h1 h1 h1 h1 h4" "h5 h5 h5 h6 h6";}#camera { grid-area: h1; overflow: hidden; color: #a181fd;}#temperature { grid-area: h2; color: #ff7907;}#humidity { color: #08c0ff; grid-area: h3;}#soil-moisture { color: #833640; grid-area: h4;}#pump { grid-area: h5; color: #159d9a;}#flash { grid-area: h6; color: black;}.state-value { font-weight: bold; color: #ba0016;}.state-on { color: #1fcd89;}.hidden{ display: none;}.center { display: block; margin-left: auto; margin-right: auto; width: 93%; height: 93%; max-width: 90vh; text-align: center; font-size: 18px;}img { border-radius: 15px;}.toggle { display: inline-block; height: 26px; position: relative; width: 47px; bottom: -6px;}.toggle input[type="checkbox"] { display: none;}.toggle .slider { background-color: #ccc; cursor: pointer; width: 100%; height: 100%; transition: .4s; position: relative; border-radius: 50px;}.toggle .slider:before { background-color: #fff; bottom: 3px; content: ""; height: 20px; width: 20px; left: 4px; position: absolute; transition: .4s; border-radius: 50%;}.toggle input[type="checkbox"]:checked + .slider { background-color: #07a787;}.toggle input[type="checkbox"]:checked + .slider:before { transform: translateX(20px);}h1 { margin-top: 20px; font-size: 1.5rem; margin-bottom: 10px; text-align: center;}.setting-container .container-item { padding-top: 15px; padding-bottom: 15px;}#submit { margin-top: 20px; width: 150px; height: 30px; border-radius: 5px; background: rgb(17, 86, 88); color: white; border: none;}#submit:hover { background: rgb(13, 68, 70);}#submit:active { background: rgb(22, 132, 136);}.number-input { margin: 3px; padding: 3px; width: 100px; border: 1px solid gray; border-radius: 5px;}.time-input { margin: 3px; padding: 3px; border: 1px solid gray; border-radius: 5px; min-width: 100px;}@media (max-width:700px) { #navbar { width: var(--navbar-width-close); }  #navbar a span { display: none; }  #navbar a:hover{ color: black; }  #container { padding: 15px; position: relative; height: calc(100vh - 30px); transition: 0.7s; background: var(--bgcl); left: calc(var(--navbar-width-close) + var(--navbar-padding-left)); width: calc(100% - (var(--navbar-width-close) + var(--navbar-padding-left) + 30px)); }  .dashboard-container { display: flex; flex-direction: column; }  .hidden { display: none; }}.value-time { /* display: inline-block; */ min-width: 74px; color: #3e306b; margin-right: 5px; padding-top: px;}#value-off-setting .value{ color: #833640;}.clear-btn { background-color: #92e0d1; border: none; border-radius: 5px; width: 50px; height: 32px; margin-left: 5px;}.time-container { min-height: 40px; display: flex; align-items: center; justify-content: center;}.time-input{ margin: 0px; padding: 0px; height: 30px;}</style></head><body> <div id="navbar" class="close"> <a id="dashboard-button" class="select" href="#"> <i class='bx bxs-dashboard'></i> <span>Dashboard</span> </a> <a id="setting-button" href="#"> <i class='bx bx-cog' ></i> <span>Setting</span> </a> </div> <div id="container"> <div class="dashboard-container"> <div id="camera" class="container-item"> <p class="header">Camera</p> <img src="" alt="Capture" class="center"> </div> <div id="temperature" class="container-item"> <p class="header">Nhiệt độ không khí</p> <p class="body center"><span class="C value">0</span>oC / <span class="F value">32</span>oF</p> </div> <div id="humidity" class="container-item"> <p class="header">Độ ẩm không khí</p> <p class="body center"><span class="value">0</span>%</p> </div> <div id="soil-moisture" class="container-item"> <p class="header">Độ ẩm đất</p> <p class="body center"><span class="value">0</span>%</p> </div> <div id="pump" class="container-item"> <p class="header">Trạng thái máy bơm</p> <p class="body center"><span class="value state-value">OFF</span></p> </div> <div id="flash" class="container-item"> <p class="header">Trạng thái đèn Flash</p> <p class="body center"><span class="value state-value">OFF</span></p> </div> </div> <div class="setting-container hidden"> <div class="container-item"> <div id="pump-control" class="header"> Bơm nước <label class="toggle" for="toggle-1"> <input type="checkbox" id="toggle-1"> <div class="slider"></div> </label> <p class="body"><span class="value state-value">OFF</span></p> </div> <div id="flash-control" class="header">Đèn Flash <label class="toggle" for="toggle-2"> <input type="checkbox" id="toggle-2"> <div class="slider"></div> </label> <p class="body"><span class="value state-value">OFF</span></p> </div> </div> <h1>Setup</h1> <div class="container-item"> <div id="value-off-setting" class="header"> <div>Độ ẩm đất tối đa ( <span class="value">100%</span>)</div> <input id="value-pump-off" type="number" min="0" max="100" class="number-input"> <span>%</span> </div> <div id="time-on-setting" class="header"> <div>Thời gian bật bơm</div> <div class="time-container"> <span id="time-value-1" class="value-time">chưa đặt</span> <input id="time-1" type="time" class="time-input"> <button class="clear-btn" onclick="document.querySelector('#time-1').value = ''">Xoá</button> </div> <div class="time-container"> <span id="time-value-2" class="value-time">chưa đặt</span> <input id="time-2" type="time" class="time-input"> <button class="clear-btn" onclick="document.querySelector('#time-2').value = ''">Xoá</button> </div> <div class="time-container"> <span id="time-value-3" class="value-time">chưa đặt</span> <input id="time-3" type="time" class="time-input"> <button class="clear-btn" onclick="document.querySelector('#time-3').value = ''">Xoá</button> </div> <div class="time-container"> <span id="time-value-4" class="value-time">chưa đặt</span> <input id="time-4" type="time" class="time-input"> <button class="clear-btn" onclick="document.querySelector('#time-4').value = ''">Xoá</button> </div> <div class="time-container"> <span id="time-value-5" class="value-time">chưa đặt</span> <input id="time-5" type="time" class="time-input"> <button class="clear-btn" onclick="document.querySelector('#time-5').value = ''">Xoá</button> </div> </div> </div> <button id="submit" class="center">Save</button> </div> </div> <script>const navbar = document.querySelector("#navbar");const navbarBtns = document.querySelectorAll("#navbar > a");const container = document.querySelectorAll("#container > div");const dashboardContainer = document.querySelector(".dashboard-container");const settingContainer = document.querySelector(".setting-container");const dashboardButton = document.querySelector("#dashboard-button");const settingButton = document.querySelector("#setting-button");navbar.onmouseleave = (e) => {navbar.classList.add("close")};navbar.onmouseenter = (e) => {navbar.classList.remove("close")};navbarBtns.forEach((e) => { e.addEventListener("click", () => { navbarBtns.forEach((b) => {b.classList.remove("select")}); container.forEach((b) => b.classList.add("hidden")); e.classList.add("select"); if (e == dashboardButton){ dashboardContainer.classList.remove("hidden"); }else if (e == settingButton){ settingContainer.classList.remove("hidden"); } }); });</script> <script>function request(method, url, type, callback=null, json=null){ var xhr = new XMLHttpRequest(); xhr.open(method, url); if(method == "POST"){ xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");  xhr.send(JSON.stringify(json)); }else{ xhr.send(); } xhr.responseType = type; xhr.onload = () => { if (xhr.readyState == 4 && xhr.status == 200) {  if(callback){ callback(xhr.response); } } else { console.log(`Error: ${xhr.status}`); if(callback){ callback({status: 1}); } } };}const temp_C_value = document.querySelector("#temperature .C.value");const temp_F_value = document.querySelector("#temperature .F.value");const humidity_value = document.querySelector("#humidity .value");const soil_value = document.querySelector("#soil-moisture .value");const pump_state = document.querySelector("#pump .value");const flash_state = document.querySelector("#flash .value");const cb_pump = document.querySelector("#pump-control input");const cb_flash = document.querySelector("#flash-control input");const pump_state_control = document.querySelector("#pump-control .value");const flash_state_control = document.querySelector("#flash-control .value");const input_soil = document.querySelector("#value-pump-off");const list_timer = [ document.querySelector("#time-1"), document.querySelector("#time-2"), document.querySelector("#time-3"), document.querySelector("#time-4"), document.querySelector("#time-5")];const setup_soil_value = document.querySelector("#value-off-setting .value");const list_timer_value = [ document.querySelector("#time-value-1"), document.querySelector("#time-value-2"), document.querySelector("#time-value-3"), document.querySelector("#time-value-4"), document.querySelector("#time-value-5")];const save_btn = document.querySelector("#submit");function set_pump_on(is_on){ if (is_on){ pump_state.textContent = "ON"; pump_state.classList.add("state-on"); pump_state_control.textContent = "ON"; pump_state_control.classList.add("state-on"); cb_pump.checked = true; }else{ pump_state.textContent = "OFF"; pump_state.classList.remove("state-on"); pump_state_control.textContent = "OFF"; pump_state_control.classList.remove("state-on"); cb_pump.checked = false; }}function set_flash_on(is_on){ if (is_on){ flash_state.textContent = "ON"; flash_state.classList.add("state-on"); flash_state_control.textContent = "ON"; flash_state_control.classList.add("state-on"); cb_flash.checked = true; }else{ flash_state.textContent = "OFF"; flash_state.classList.remove("state-on"); flash_state_control.textContent = "OFF"; flash_state_control.classList.remove("state-on"); cb_flash.checked = false; }}cb_pump.onclick = () => { if (cb_pump.checked){ request("GET", "/api/pump_on", "json", (data) => { if (data.status == 0){ set_pump_on(true); } else { alert("Bật bơm thất bại"); cb_pump.checked = false; } }); }else{ request("GET", "/api/pump_off", "json", (data) => { if (data.status == 0){ set_pump_on(false); } else { alert("Tắt bơm thất bại"); cb_pump.checked = true; } }); }};cb_flash.onclick = () => { if (cb_flash.checked){ request("GET", "/api/flash_on", "json", (data) => { if (data.status == 0){ set_flash_on(true); } else { alert("Bật đèn thất bại"); cb_flash.checked = false; } }); }else{ request("GET", "/api/flash_off", "json", (data) => { if (data.status == 0){ set_flash_on(false); } else { alert("Tắt đèn thất bại"); cb_flash.checked = true; } }); }};function minuteAsStringTime(m, _default = ""){ if (m < 0) return _default; var h = parseInt(m / 60); var m = m % 60; return (h < 10 ? "0" + h: h) + ":" + (m < 10 ? "0" + m : m);}function getData(){ request("GET", "/api/get", "json", updateData);}function updateData(data){  if (data.status == 0){ temp_C_value.textContent = data.temp; temp_F_value.textContent = (parseInt(data.temp) * 1.8 + 32).toFixed(2); humidity_value.textContent = data.humidity; soil_value.textContent = data.soil.toFixed(2); set_pump_on(data.pump); set_flash_on(data.flash); setup_soil_value.textContent = data.soil_set + "%"; for (let i = 0; i < 5; i++) { list_timer_value[i].textContent = minuteAsStringTime(data.timer[i], "chưa đặt"); } } setTimeout(getData, 3000);}const camera = document.querySelector("#camera img");function refreshCapture(){ request("GET", "/api/capture", "arraybuffer", (arrayBuffer) => { camera.src = "/api/capture"; setTimeout(refreshCapture, 5000); });}function stringTimeAsMinute(t){ if (!t) { return -1 } var h_m = t.split(":"); h = parseInt(h_m[0]); m = parseInt(h_m[1]); return h * 60 + m;}save_btn.onclick = () => { const s = input_soil.value; if (s > 100 || s < 0) { alert("giá trị đổ ẩm không hợp lệ! (0 - 100)"); return; } var lst_v = []; var lst_t = []; for (t of list_timer) { lst_t.push(t.value ? t.value : "chưa đặt"); lst_v.push(stringTimeAsMinute(t.value)); } request("POST", "api/set", "json", (data) => { if (data.status == 0){ setup_soil_value.textContent = s + "%"; for (let i = 0; i < 5; i++){ list_timer_value[i].textContent = lst_t[i]; } alert("Lưu thành công"); } else { alert("Lưu thất bại"); } }, { soil: s ? parseFloat(s) : 100.0, timer: lst_v });};function getDataOnload(){ request("GET", "/api/get", "json", (data) => { if (data.status == 0){ updateData(data); input_soil.value = data.soil_set; for (let i = 0; i < 5; i++) { list_timer[i].value = list_timer_value[i].textContent; } } });}document.addEventListener("DOMContentLoaded", () => {  getDataOnload(); refreshCapture();});</script></body></html>